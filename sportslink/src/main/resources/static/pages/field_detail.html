<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Campo - SportsLink</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="../css/styles.css" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="../pages/main_page_user.html">
                <i class="material-icons me-2 text-accent">sports_soccer</i>
                <span class="text-gradient fw-bold fs-4">SportsLink</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link fw-medium" href="../pages/main_page_user.html">Home</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4 mb-5">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../pages/main_page_user.html">Home</a></li>
                <li class="breadcrumb-item active" id="breadcrumb-field">Campo</li>
            </ol>
        </nav>

        <!-- Campo Info Card -->
        <div class="card shadow-sm mb-4" id="field-card">
            <div class="card-body p-4">
                <div class="row">
                    <div class="col-md-8">
                        <div class="d-flex align-items-start mb-3">
                            <i class="material-icons text-accent icon-large me-3" id="field-icon">sports_soccer</i>
                            <div>
                                <h2 class="fw-bold mb-2" id="field-name">Loading...</h2>
                                <p class="text-muted mb-2">
                                    <i class="material-icons icon-small align-middle">location_on</i>
                                    <span id="field-location">-</span>
                                </p>
                                <p class="text-muted mb-0" id="field-description">-</p>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <strong>Horário:</strong>
                                    <span id="field-hours">-</span>
                                </div>
                                <div class="mb-3">
                                    <strong>Avaliação:</strong>
                                    <span id="field-rating">-</span> ⭐
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <strong>Desporto:</strong>
                                    <span class="badge bg-accent text-white" id="field-sport">-</span>
                                </div>
                                <div class="mb-3">
                                    <strong>Endereço:</strong>
                                    <span id="field-address">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 text-end">
                        <div class="p-4 bg-light rounded">
                            <h3 class="text-accent fw-bold mb-2" id="field-price">€-/hora</h3>
                            <button class="btn bg-accent text-white fw-bold w-100" id="btn-book">
                                Reservar Agora
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Equipamentos Section -->
        <div class="card shadow-sm">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="fw-bold mb-0">Equipamentos Disponíveis</h4>
                    <button class="btn btn-outline-primary" id="btn-view-equipments">
                        Ver Todos os Equipamentos
                    </button>
                </div>
                
                <div id="equipment-preview" class="row g-3">
                    <!-- Equipment cards will be rendered here -->
                </div>
                
                <div id="no-equipments" class="text-center text-muted py-4" style="display: none;">
                    <i class="material-icons icon-large">inventory_2</i>
                    <p class="mt-2">Nenhum equipamento disponível</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        (() => {
            const urlParams = new URLSearchParams(window.location.search);
            const facilityId = urlParams.get('id');
            
            if (!facilityId) {
                window.location.href = '../pages/main_page_user.html';
                return;
            }

            let facilityData = null;

            const sportIcons = {
                'Football': 'sports_soccer',
                'Padel': 'sports_tennis',
                'Tennis': 'sports_tennis',
                'Basketball': 'sports_basketball',
                'Volleyball': 'sports_volleyball'
            };

            async function loadFacility() {
                try {
                    // Get all facilities and find the one we need
                    const res = await fetch('/api/rentals/search');
                    const facilities = await res.json();
                    facilityData = facilities.find(f => f.id == facilityId);
                    
                    if (!facilityData) {
                        alert('Campo não encontrado');
                        window.location.href = '../pages/main_page_user.html';
                        return;
                    }

                    // Update page
                    document.getElementById('field-name').textContent = facilityData.name;
                    document.getElementById('field-location').textContent = facilityData.city;
                    document.getElementById('field-description').textContent = facilityData.description || 'Sem descrição disponível';
                    document.getElementById('field-hours').textContent = 
                        `${facilityData.openingTime || '08:00'} - ${facilityData.closingTime || '22:00'}`;
                    document.getElementById('field-rating').textContent = facilityData.rating || '0.0';
                    document.getElementById('field-sport').textContent = facilityData.sportType;
                    document.getElementById('field-address').textContent = facilityData.address;
                    document.getElementById('field-price').textContent = `€${facilityData.pricePerHour}/hora`;
                    document.getElementById('breadcrumb-field').textContent = facilityData.name;
                    
                    const icon = sportIcons[facilityData.sportType] || 'sports';
                    document.getElementById('field-icon').textContent = icon;

                    loadEquipmentPreview();
                } catch (err) {
                    console.error('Error loading facility:', err);
                    alert('Erro ao carregar campo');
                }
            }

            async function loadEquipmentPreview() {
                try {
                    const res = await fetch(`/api/rentals/facility/${facilityId}/equipments`);
                    const equipments = await res.json();
                    
                    const container = document.getElementById('equipment-preview');
                    container.innerHTML = '';
                    
                    if (equipments.length === 0) {
                        document.getElementById('no-equipments').style.display = 'block';
                        return;
                    }

                    // Show first 3 equipments
                    equipments.slice(0, 3).forEach(eq => {
                        const div = document.createElement('div');
                        div.className = 'col-md-4';
                        div.innerHTML = `
                            <div class="card border">
                                <div class="card-body">
                                    <h6 class="fw-bold">${eq.name}</h6>
                                    <p class="text-muted small mb-2">${eq.description || ''}</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge bg-success">${eq.status}</span>
                                        <span class="fw-bold text-accent">€${eq.pricePerHour}/h</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        container.appendChild(div);
                    });
                } catch (err) {
                    console.error('Error loading equipments:', err);
                }
            }

            document.getElementById('btn-book').addEventListener('click', () => {
                window.location.href = `booking.html?facilityId=${facilityId}`;
            });

            document.getElementById('btn-view-equipments').addEventListener('click', () => {
                window.location.href = `equipments.html?facilityId=${facilityId}`;
            });

            loadFacility();
        })();
    </script>
</body>
</html>
